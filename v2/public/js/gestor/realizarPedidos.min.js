class Ajax{callController(parameter,callBackFunction){$.ajax({url:"../ajax/",type:"POST",data:parameter,dataType:"json",success:function(callBackData){eval(callBackFunction+"(callBackData)")},error:function(a,typeError,textError){let error0='{"errMessage": "Se ha producido un error en la conexion", "errCodeException": "", "errMessageException": "" }',error1='{"errMessage": "Se ha producido un error en la conexion", "errCodeException":"'+typeError+'", "errMessageException":"'+textError+'"}';eval(callBackFunction+'({"succes": false, "errores": ['+error0+","+error1+"]})")}})}}class RealizarPedidos{getParameterGetClientes(){return"action=getClientes&"+$("#formSearch").serialize()}getParameterSearchArticulos(){return"action=searchArticulosActivos&"+$("#formSearch").serialize()}getParameterProcesarArticulos(){let e="action=procesarArticulos&usuario="+$("#usuario").val()+"&cod_gestor="+$("#cod_gestor").val()+"&cod_cliente="+$("#cod_cliente").val();for(let a=0;a<indexLocal.length;a++)"0"!==$("#cod_articulo-"+indexLocal[a]).val()&&(e+="&cod_articulo-"+indexLocal[a]+"="+$("#cod_articulo-"+indexLocal[a]).val());return e}iniIndex(){""!==(indexLocal=JSON.parse(localStorage.getItem("index")))&&null!==indexLocal||(indexLocal=[])}iniArticulosCarrito(){""!==(articulosCarrito=JSON.parse(localStorage.getItem("articulos")))&&null!==articulosCarrito||(articulosCarrito={})}borrarArticulosCarrito(){articulosCarrito={},indexLocal=[],localStorage.setItem("articulos",JSON.stringify(articulosCarrito)),localStorage.setItem("index",JSON.stringify(indexLocal))}evalInputsCantidades(){let e=[];e.success=!0,e.errores=[],e.empty=!0;for(let a=0;a<articulos.length;a++)validateCantidad($("#cod_articuloReal-"+articulos[a].cod_articulo).val())||(e.success=!1,e.errores.push(articulos[a].cod_articulo+" - "+articulos[a].nombre)),"0"!==$("#cod_articuloReal-"+articulos[a].cod_articulo).val()&&(e.empty=!1);return e}evalInputsCantidadesUpdateCarrito(){this.iniIndex(),this.iniArticulosCarrito();let e=[];e.success=!0,e.errores=[];for(let a=0;a<indexLocal.length;a++)validateCantidad($("#cod_articulo-"+indexLocal[a]).val())||(e.success=!1,e.errores.push(indexLocal[a]+" - "+articulosCarrito["articulo"+indexLocal[a]].nombre));return e}evalInputsCantidadesProcesarCarrito(){this.iniIndex(),this.iniArticulosCarrito();let e=[];e.success=!0,e.errores=[],e.empty=!0;for(let a=0;a<indexLocal.length;a++)validateCantidad($("#cod_articulo-"+indexLocal[a]).val())||(e.success=!1,e.errores.push(indexLocal[a]+" - "+articulosCarrito["articulo"+indexLocal[a]].nombre)),"0"!==$("#cod_articulo-"+indexLocal[a]).val()&&(e.empty=!1);return e}addLocalStorage(){this.iniIndex(),this.iniArticulosCarrito();for(let e=0;e<articulos.length;e++)if("0"!==$("#cod_articuloReal-"+articulos[e].cod_articulo).val())if(articulosCarrito["articulo"+articulos[e].cod_articulo]={},articulosCarrito["articulo"+articulos[e].cod_articulo].cod_articulo=articulos[e].cod_articulo,articulosCarrito["articulo"+articulos[e].cod_articulo].nombre=articulos[e].nombre,articulosCarrito["articulo"+articulos[e].cod_articulo].descripcion=articulos[e].descripcion,articulosCarrito["articulo"+articulos[e].cod_articulo].precio=articulos[e].precio,articulosCarrito["articulo"+articulos[e].cod_articulo].descuento=articulos[e].descuento,articulosCarrito["articulo"+articulos[e].cod_articulo].iva=articulos[e].iva,articulosCarrito["articulo"+articulos[e].cod_articulo].cantidad=$("#cod_articuloReal-"+articulos[e].cod_articulo).val(),0===indexLocal.length)indexLocal.push(articulos[e].cod_articulo);else{let a=!1;for(let t=0;t<indexLocal.length;t++)articulos[e].cod_articulo===indexLocal[t]&&(a=!0);a||indexLocal.push(articulos[e].cod_articulo)}localStorage.setItem("articulos",JSON.stringify(articulosCarrito)),localStorage.setItem("index",JSON.stringify(indexLocal))}updateLocalStorage(){this.iniIndex(),this.iniArticulosCarrito();for(let e=0;e<indexLocal.length;e++)for(let a=0;a<articulos.length;a++)articulos[a].cod_articulo===indexLocal[e]&&(articulosCarrito["articulo"+articulos[a].cod_articulo].cod_articulo=articulos[a].cod_articulo,articulosCarrito["articulo"+articulos[a].cod_articulo].nombre=articulos[a].nombre,articulosCarrito["articulo"+articulos[a].cod_articulo].descripcion=articulos[a].descripcion,articulosCarrito["articulo"+articulos[a].cod_articulo].precio=articulos[a].precio,articulosCarrito["articulo"+articulos[a].cod_articulo].descuento=articulos[a].descuento,articulosCarrito["articulo"+articulos[a].cod_articulo].iva=articulos[a].iva,articulosCarrito["articulo"+articulos[a].cod_articulo].cantidad=$("#cod_articulo-"+articulos[a].cod_articulo).val());localStorage.setItem("articulos",JSON.stringify(articulosCarrito))}getTextErrorCantidades(e){let a="<strong>Los siguientes articulos tienen un formato de cantidades incorrectas</strong><br>";for(let t=0;t<e.length;t++)a+=e[t];return a}}function borrarCarrito(){realizarPedidosApp.borrarArticulosCarrito(),msjInfo("REALIZAR PEDIDOS","<strong>Se ha borrado el carrito correctamente</strong>"),cleanTbody(),injectTitleArticulos()}function evalCantidadesAgregar(){let e=realizarPedidosApp.evalInputsCantidades();e.success?e.empty?msjInfo("REALIZAR PEDIDOS","<strong>Todas las cantidades son 0</strong>"):(realizarPedidosApp.addLocalStorage(),msjSucces("REALIZAR PEDIDOS","<strong>Se ha actualizado su carrito correctamente</strong>")):msjDanger("REALIZAR PEDIDOS",realizarPedidosApp.getTextErrorCantidades(e.errores))}function carrito(){realizarPedidosApp.iniIndex(),realizarPedidosApp.iniArticulosCarrito(),cleanTbody(),injectTitleCarrito(),Object.keys(articulosCarrito).length>0&&(injectCarrito(articulosCarrito),addEventsCarrito())}function updateCarrito(){realizarPedidosApp.iniIndex(),realizarPedidosApp.iniArticulosCarrito();let e=realizarPedidosApp.evalInputsCantidadesUpdateCarrito();e.success?(realizarPedidosApp.updateLocalStorage(),msjSucces("REALIZAR PEDIDOS","<strong>Se ha actualizado su carrito correctamente</strong>")):msjDanger("REALIZAR PEDIDOS",realizarPedidosApp.getTextErrorCantidades(e.errores))}function evalCantidadesCarrito(){let e=realizarPedidosApp.evalInputsCantidadesProcesarCarrito();e.success?e.empty?msjInfo("REALIZAR PEDIDOS","<strong>Todas las cantidades son 0</strong>"):ajaxApp.callController(realizarPedidosApp.getParameterProcesarArticulos(),"callBackEvalCantidadesCarrito"):msjDanger("REALIZAR PEDIDOS",realizarPedidosApp.getTextErrorCantidades(e.errores))}function callBackEvalCantidadesCarrito(e){e.success?(realizarPedidosApp.borrarArticulosCarrito(),cleanTbody(),injectTitleArticulos(),msjSucces("REALIZAR PEDIDOS","<strong>Se ha generado su pedido correctamente</strong>")):msjDanger("",e.errores[0].errMessage)}var realizarPedidosApp=new RealizarPedidos,ajaxApp=new Ajax,articulos="",indexLocal=[],articulosCarrito={};function addEventsRealizarPedidos(){iniUsuarios(),$("#search").click(search),$("#carrito").click(carrito),$("#borrar").click(borrarCarrito)}function addEventsSiguiente(){$("#siguiente").click(searchSiguiente)}function addEventsAnterior(){$("#anterior").click(searchAnterior)}function delEventsSig(){$("#siguiente").off()}function delEventsAnt(){$("#anterior").off()}function addEventsAgregar(){$(document).off("click","#agregar"),$(document).on("click","#agregar",evalCantidadesAgregar)}function addEventsCarrito(){$(document).off("click","#procesar"),$(document).on("click","#procesar",evalCantidadesCarrito),$(document).off("click","#actualizar"),$(document).on("click","#actualizar",updateCarrito)}function validateCantidad(e){return esNumeroPositivoEntero(e)||"0"===e}function iniUsuarios(){ajaxApp.callController(realizarPedidosApp.getParameterGetClientes(),"callBackIniUsuarios")}function callBackIniUsuarios(e){e.success?e.usuarios_cliente.length>0&&(injectClientes(e.usuarios_cliente),enableBuscar(),enableCarrito()):msjDanger("REALIZAR PEDIDOS",e.errores[0].errMessage)}function search(){cleanTbody(),injectTitleArticulos(),delEventsSig(),delEventsAnt(),$("#numPage").val(1),injectPageNumber(),ajaxApp.callController(realizarPedidosApp.getParameterSearchArticulos(),"callBackSearchArticulos")}function callBackSearchArticulos(e){e.success?0!==e.articulos.length?(injectArticulos(articulos=e.articulos),addEventsSiguiente(),addEventsAgregar()):(disableProcesar(),articulos=""):msjDanger("REALIZAR PEDIDOS",e.errores[0].errMessage)}function searchSiguiente(){delEventsSig(),delEventsAnt(),$("#numPage").val(1*$("#numPage").val()+1),ajaxApp.callController(realizarPedidosApp.getParameterSearchArticulos(),"callBackSearchSiguiente")}function callBackSearchSiguiente(e){e.success?(0!==e.articulos.length?(cleanTbody(),injectTitleArticulos(),articulos=e.articulos,injectArticulos(e.articulos),addEventsAgregar(),addEventsSiguiente()):$("#numPage").val(1*$("#numPage").val()-1),"1"!==$("#numPage").val()&&addEventsAnterior(),injectPageNumber()):msjDanger("REALIZAR PEDIDOS",e.errores[0].errMessage)}function searchAnterior(){delEventsSig(),delEventsAnt(),$("#numPage").val(1*$("#numPage").val()-1),ajaxApp.callController(realizarPedidosApp.getParameterSearchArticulos(),"callBackSearchAnterior")}function callBackSearchAnterior(e){e.success?(cleanTbody(),injectTitleArticulos(),articulos=e.articulos,injectArticulos(e.articulos),addEventsAgregar(),addEventsSiguiente(),"1"!==$("#numPage").val()&&addEventsAnterior(),injectPageNumber()):msjDanger("REALIZAR PEDIDOS",e.errores[0].errMessage)}function esTexto(e){let a=!0;if(""!==e&&null!==e)for(let t=0;t<e.length;t++)esLetra(e[t])||(a=!1,t=e.length);else a=!1;return a}function esTextoNumero(e){let a=!0;if(""!==e&&null!==e)for(let t=0;t<e.length;t++)esLetra(e[t])||esNumeros(e[t])||(a=!1,t=e.length);else a=!1;return a}function esTextoEspacio(e){let a=!0;if(""!==e&&null!==e)for(let t=0;t<e.length;t++)esLetra(e[t])||esEspacio(e[t])||(a=!1,t=e.length);else a=!1;return a}function esNumeroMas(e){let a=!0;if(""!==e&&null!==e)for(let t=0;t<e.length;t++)esNumero(e[t])||esMas(e[t])||(a=!1,t=e.length);else a=!1;return a}function esNumeroGuion(e){let a=!0;if(""!==e&&null!==e)for(let t=0;t<e.length;t++)esNumero(e[t])||esGuion(e[t])||(a=!1,t=e.length);else a=!1;return a}function esNumeros(e){let a=!0;if(""!==e&&null!==e)for(let t=0;t<e.length;t++)esNumero(e[t])||(a=!1,t=e.length);else a=!1;return a}function esTextoEspacioPuntoComaBarraNumero(e){let a=!0;if(""!==e&&null!==e)for(let t=0;t<e.length;t++)esTexto(e[t])||esEspacio(e[t])||esPunto(e[t])||esComa(e[t])||esNumero(e[t])||esBarra(e[t])||(a=!1,t=e.length);else a=!1;return a}function esTextoPunto(e){let a=!0;if(""!==e&&null!==e)for(let t=0;t<e.length;t++)esTexto(e[t])||esPunto(e[t])||(a=!1,t=e.length);else a=!1;return a}function esTextoBarra(e){let a=!0;if(""!==e&&null!==e)for(let t=0;t<e.length;t++)esTexto(e[t])||esPunto(e[t])||(a=!1,t=e.length);else a=!1;return a}function esNumeroPositivoEntero(e){return parseInt(e)&&esPositivo(e)&&esEntero(e)}function esLetra(e){return e.charCodeAt()>64&&e.charCodeAt()<91||165===e.charCodeAt()||164===e.charCodeAt()||e.charCodeAt()>96&&e.charCodeAt()<123}function esEspacio(e){return 32===e.charCodeAt()}function esNumero(e){return e.charCodeAt()>47&&e.charCodeAt()<58}function esPositivo(e){return 1*e>0}function esEntero(e){return 1*e%1==0}function esGuion(e){return 45===e.charCodeAt()}function esPunto(e){return 46===e.charCodeAt()}function esComa(e){return 44===e.charCodeAt()}function esContBarra(e){return 47===e.charCodeAt()}function esBarra(e){return 92===e.charCodeAt()}function esMas(e){return 43===e.charCodeAt()}function msjDanger(e,a){let t=Math.floor(1e16*Math.random()+1);$("#mensajes").append('<div class="modal fade bd-example-modal-lg" id="danger'+t+'" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header modal-header-danger"><h1>'+e+'</h1></div><div class="modal-body">'+a+'</div><div class="modal-footer"><button type="button" class="btn btn-default pull-rigth" data-dismiss="modal">Cerrar</button></div></div></div></div>'),$("#danger"+t).modal("show")}function msjWarning(e,a){let t=Math.floor(1e16*Math.random()+1);$("#mensajes").append('<div class="modal fade bd-example-modal-lg" id="warning'+t+'" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header modal-header-warning"><h1>'+e+'</h1></div><div class="modal-body">'+a+'</div><div class="modal-footer"><button type="button" class="btn btn-default pull-rigth" data-dismiss="modal">Cerrar</button></div></div></div></div>'),$("#warning"+t).modal("show")}function msjSucces(e,a){let t=Math.floor(1e16*Math.random()+1);$("#mensajes").append('<div class="modal fade bd-example-modal-lg" id="success'+t+'" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header modal-header-success"><h1>'+e+'</h1></div><div class="modal-body">'+a+'</div><div class="modal-footer"><button type="button" class="btn btn-default pull-rigth" data-dismiss="modal">Cerrar</button></div></div></div></div>'),$("#success"+t).modal("show")}function msjInfo(e,a){let t=Math.floor(1e16*Math.random()+1);$("#mensajes").append('<div class="modal fade bd-example-modal-lg" id="info'+t+'" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header modal-header-info"><h1>'+e+'</h1></div><div class="modal-body">'+a+'</div><div class="modal-footer"><button type="button" class="btn btn-default pull-rigth" data-dismiss="modal">Cerrar</button></div></div></div></div>'),$("#info"+t).modal("show")}function cleanTbody(){$("#tbody").empty()}function disableProcesar(){$("#procesar").attr("disabled",!0)}function enableBuscar(){$("#search").attr("disabled",!1)}function enableCarrito(){$("#carrito").attr("disabled",!1)}function injectTitleArticulos(){$("#title").empty(),$("#title").append("Articulo")}function injectTitleCarrito(){$("#title").empty(),$("#title").append("Carrito")}function injectArticulos(e){for(let a=0;a<e.length;a++)$("#tbody").append("<tr><td>"+e[a].cod_articulo+"</td><td>"+e[a].nombre+"</td><td>"+e[a].descripcion+"</td><td>"+(""+(1*e[a].precio).toFixed(2)).replace(".",",")+"</td><td>"+e[a].descuento.replace(".",",")+"</td><td>"+e[a].iva.replace(".",",")+'</td><td><input type="number"  id="cod_articuloReal-'+e[a].cod_articulo+'" name="cod_articuloReal-'+e[a].cod_articulo+'" min="0" step="1" value="0"></td></tr>');$("#tbody").append('<tr><td></td><td></td><td></td><td></td><td></td><td></td><td><input type="button" id="agregar" name="agregar" class="form-control btn-warning" value="Agregar"></td></tr>')}function injectCarrito(e){$.each(e,function(e,a){$("#tbody").append("<tr><td>"+a.cod_articulo+"</td><td>"+a.nombre+"</td><td>"+a.descripcion+"</td><td>"+(""+(1*a.precio).toFixed(2)).replace(".",",")+"</td><td>"+a.descuento.replace(".",",")+"</td><td>"+a.iva.replace(".",",")+'</td><td><input type="number"  id="cod_articulo-'+a.cod_articulo+'" name="cod_articulo-'+a.cod_articulo+'" min="0" step="1" value="'+a.cantidad+'"></td></tr>')}),$("#tbody").append('<tr><td></td><td></td><td></td><td></td><td></td><td></td><td><input type="button" id="procesar" name="procesar" class="form-control btn-warning" value="Procesar"></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td><input type="button" id="actualizar" name="actualizar" class="form-control btn-warning" value="Actualizar"></td></tr>')}function injectClientes(e){for(let a=0;a<e.length;a++)$("#cod_cliente").append('<option value="'+e[a].cod_cliente+'">'+e[a].cod_cliente+"-"+e[a].nombre_completo+"</option>")}function injectPageNumber(){$("#pageActual").empty(),$("#pageActual").append($("#numPage").val())}document.onload=addEventsRealizarPedidos();