"use strict";class Ajax{callController(parameter,callBackFunction){$.ajax({url:"../app/controller/ajax.php",type:"POST",data:parameter,dataType:"json",success:function(callBackData){eval(callBackFunction+"(callBackData)")},error:function(a,typeError,textError){let error0='{"errMessage": "Se ha producido un error en la conexion", "errCodeException": "", "errMessageException": "" }',error1='{"errMessage": "Se ha producido un error en la conexion", "errCodeException":"'+typeError+'", "errMessageException":"'+textError+'"}';eval(callBackFunction+'({"succes": false, "errores": ['+error0+","+error1+"]})")}})}}class PedidosCliente{getParameterSearchPedidosCliente(){return"action=searchPedidos&"+$("#formSearch").serialize()}getParameterSearchLineas(e){return"action=searchLineasPedidos&cod_pedido="+e+"&"+$("#formSearch").serialize()}getParameterUpdateLineas(){return"action=updateLineasPedidos&"+$("#formLineas").serialize()}evalInputsCantidades(){let e=document.getElementsByClassName("cantidades"),t=[];t.success=!0,t.errores=[];for(let a=0;a<e.length;a++)validateCantidad(e[a].value)||(t.success=!1,t.errores.push(e[a].name.split("-")[0]+" - "+e[a].name.split("-")[1]));return t}getTextErrorCantidades(e){let t="<strong>Las siguientes lineas de pedidos tienen un formato de cantidades incorrectas</strong><br>";for(let a=0;a<e.length;a++)t+=e[a];return t}}function validateCantidad(e){return esNumeroPositivoEntero(e)||"0"===e}function searchLineas(e){cleanLineas();var t=e.target.id.split("-")[1];msjClean(),ajaxApp.callController(pedidosClienteApp.getParameterSearchLineas(t),"callBackSearchLineas")}function callBackSearchLineas(e){e.success?(addEventsButtonLineas(),injectLineas(e.lineas_pedidos)):msjDanger("SEARCH PEDIDOS",e.errores[0].errMessage)}function evalCantidades(){msjClean();let e=pedidosClienteApp.evalInputsCantidades();e.success?ajaxApp.callController(pedidosClienteApp.getParameterUpdateLineas(),"callBackEvalCantidades"):msjDanger("ACTUALIZAR PEDIDO",pedidosClienteApp.getTextErrorCantidades(e.errores))}function callBackEvalCantidades(e){e.success?(msjSucces("ACTUALIZAR PEDIDO","<strong>Se ha actualizado correctamente su pedido</strong>"),restorePedidos(),cleanTbody()):msjDanger("PROCESAR",e.errores[0].errMessage)}function search(){cleanTbody(),restorePedidos(),delEventsSig(),delEventsAnt(),$("#numPage").val(1),injectPageNumber(),msjClean(),ajaxApp.callController(pedidosClienteApp.getParameterSearchPedidosCliente(),"callBackSearchPedidosCliente")}function callBackSearchPedidosCliente(e){e.success?0!==e.pedidos.length&&(injectPedidos(e.pedidos),addEventsLineas(e.pedidos),addEventsSiguiente()):msjDanger("SEARCH PEDIDOS",e.errores[0].errMessage)}function searchSiguiente(){restorePedidos(),delEventsSig(),delEventsAnt(),msjClean(),$("#numPage").val(1*$("#numPage").val()+1),ajaxApp.callController(pedidosClienteApp.getParameterSearchPedidosCliente(),"callBackSearchSiguiente")}function callBackSearchSiguiente(e){e.success?(0!==e.pedidos.length?(cleanTbody(),injectPedidos(e.pedidos),addEventsLineas(e.pedidos),addEventsSiguiente()):$("#numPage").val(1*$("#numPage").val()-1),"1"!==$("#numPage").val()&&addEventsAnterior(),injectPageNumber()):msjDanger("SEARCH PEDIDOS",e.errores[0].errMessage)}function searchAnterior(){restorePedidos(),delEventsSig(),delEventsAnt(),msjClean(),$("#numPage").val(1*$("#numPage").val()-1),ajaxApp.callController(pedidosClienteApp.getParameterSearchPedidosCliente(),"callBackSearchAnterior")}function callBackSearchAnterior(e){e.success?(cleanTbody(),injectPedidos(e.pedidos),addEventsLineas(e.pedidos),addEventsSiguiente(),"1"!==$("#numPage").val()&&addEventsAnterior(),injectPageNumber()):msjDanger("SEARCH PEDIDOS",e.errores[0].errMessage)}var pedidosClienteApp=new PedidosCliente,ajaxApp=new Ajax;function addEventsPedidos(){$("#search").click(search),$("#procesar").click(evalCantidades)}function addEventsSiguiente(){$("#siguiente").click(searchSiguiente)}function addEventsAnterior(){$("#anterior").click(searchAnterior)}function delEventsSig(){$("#siguiente").off()}function delEventsAnt(){$("#anterior").off()}function addEventsLineas(e){for(let t=0;t<e.length;t++)$("#cod_pedido-"+e[t].cod_pedido).off(),$("#cod_pedido-"+e[t].cod_pedido).click(searchLineas)}function addEventsButtonLineas(){$("#buttonLineas").off(),$("#buttonVolver").off(),$(document).on("click","#buttonLineas",evalCantidades),$(document).on("click","#buttonVolver",restorePedidos)}function esTexto(e){let t=!0;if(""!==e&&null!==e)for(let a=0;a<e.length;a++)esLetra(e[a])||(t=!1,a=e.length);else t=!1;return t}function esTextoNumero(e){let t=!0;if(""!==e&&null!==e)for(let a=0;a<e.length;a++)esLetra(e[a])||esNumeros(e[a])||(t=!1,a=e.length);else t=!1;return t}function esTextoEspacio(e){let t=!0;if(""!==e&&null!==e)for(let a=0;a<e.length;a++)esLetra(e[a])||esEspacio(e[a])||(t=!1,a=e.length);else t=!1;return t}function esNumeroMas(e){let t=!0;if(""!==e&&null!==e)for(let a=0;a<e.length;a++)esNumero(e[a])||esMas(e[a])||(t=!1,a=e.length);else t=!1;return t}function esNumeroGuion(e){let t=!0;if(""!==e&&null!==e)for(let a=0;a<e.length;a++)esNumero(e[a])||esGuion(e[a])||(t=!1,a=e.length);else t=!1;return t}function esNumeros(e){let t=!0;if(""!==e&&null!==e)for(let a=0;a<e.length;a++)esNumero(e[a])||(t=!1,a=e.length);else t=!1;return t}function esTextoEspacioPuntoComaBarraNumero(e){let t=!0;if(""!==e&&null!==e)for(let a=0;a<e.length;a++)esTexto(e[a])||esEspacio(e[a])||esPunto(e[a])||esComa(e[a])||esNumero(e[a])||esBarra(e[a])||(t=!1,a=e.length);else t=!1;return t}function esTextoPunto(e){let t=!0;if(""!==e&&null!==e)for(let a=0;a<e.length;a++)esTexto(e[a])||esPunto(e[a])||(t=!1,a=e.length);else t=!1;return t}function esTextoBarra(e){let t=!0;if(""!==e&&null!==e)for(let a=0;a<e.length;a++)esTexto(e[a])||esPunto(e[a])||(t=!1,a=e.length);else t=!1;return t}function esNumeroPositivoEntero(e){return parseInt(e)&&esPositivo(e)&&esEntero(e)}function esLetra(e){return e.charCodeAt()>64&&e.charCodeAt()<91||165===e.charCodeAt()||164===e.charCodeAt()||e.charCodeAt()>96&&e.charCodeAt()<123}function esEspacio(e){return 32===e.charCodeAt()}function esNumero(e){return e.charCodeAt()>47&&e.charCodeAt()<58}function esPositivo(e){return parseInt(e)>0}function esEntero(e){return parseInt(e)%1==0}function esGuion(e){return 45===e.charCodeAt()}function esPunto(e){return 46===e.charCodeAt()}function esComa(e){return 44===e.charCodeAt()}function esContBarra(e){return 47===e.charCodeAt()}function esBarra(e){return 92===e.charCodeAt()}function esMas(e){return 43===e.charCodeAt()}function cleanTbody(){$("#tbody").empty()}function restorePedidos(){$("#tableLineas").empty(),$("#tablePedidos").attr("hidden",!1)}function cleanLineas(){$("#tableLineas").empty()}function injectPedidos(e){for(let t=0;t<e.length;t++)$("#tbody").append('<tr><td><input type="button" value="'+e[t].cod_pedido+'" class="form-control btn-default"></td><td><input type="button" value="'+e[t].cod_cliente+'" class="form-control btn-default"></td><td><input type="button" value="'+e[t].fecha+'" class="form-control btn-default"></td><td><input type="button" value="'+e[t].estado+'" class="form-control btn-default"></td><td><input type="button" id="cod_pedido-'+e[t].cod_pedido+'" value="'+e[t].lineas+'" class="form-control btn-primary"></td></tr>')}function injectPageNumber(){$("#pageActual").empty(),$("#pageActual").append($("#numPage").val())}function injectLineas(e){let t='<form id="formLineas" name="formLineas"><h2>cod_pedido '+e[0].cod_pedido+'</h2><input type="hidden" id="usuario" name="usuario" value="cliente"><input type="hidden" name="cod_cliente" value="'+$("#cod_cliente").val()+'"><input type="hidden" id="cod_pedido" name="cod_pedido" value="'+e[0].cod_pedido+'"><div class="table-responsive"><table class="table table-hover"><thead><tr><th>cod_linea</th><th>articulo</th><th>precio</th><th>iva</th><th>total</th><th>estado</th><th>cantidad</th></tr></thead><tbody>';for(let a=0;a<e.length;a++)t+='<tr><td><input type="button" value="'+e[a].cod_linea+'" class="form-control btn-default"></td><td><input type="button" value="'+e[a].nombre_articulo+'" class="form-control btn-default"></td><td><input type="button" value="'+e[a].precio+'" class="form-control btn-default"></td><td><input type="button" value="'+e[a].iva+'" class="form-control btn-default"></td><td><input type="button" value="'+e[a].total+'" class="form-control btn-default"></td><td><input type="button" value="'+e[a].estado+'" class="form-control btn-default"></td>',"pendiente"===e[a].estado?t+='<td><input type="number" name="cod_linea-'+e[a].cod_linea+'" value="'+e[a].cantidad+'" class="cantidades form-control" min="0" step="1"></td></tr>':t+='<td><input type="number" name="cod_linea-'+e[a].cod_linea+'" value="'+e[a].cantidad+'" class="cantidades form-control" min="0" step="1" disabled></td></tr>';t+='<tr><td></td><td></td><td></td><td></td><td></td><td></td><td><input type="button" id="buttonLineas" name="buttonLineas" class="form-control btn-warning" value="Actualizar cantidades"></td></tr>',t+='<tr><td></td><td></td><td></td><td></td><td></td><td></td><td><input type="button" id="buttonVolver" name="buttonVolver" class="form-control btn-primary" value="Volver pedidos"></td></tr>',t+="</tbody></table></div></form>",$("#tablePedidos").attr("hidden",!0),$("#tableLineas").append(t)}function msjDanger(e,t){$("#mensajes").append('<div class="modal fade bd-example-modal-lg" id="danger" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header modal-header-danger"><h1>'+e+'</h1></div><div class="modal-body">'+t+'</div><div class="modal-footer"><button type="button" class="btn btn-default pull-rigth" data-dismiss="modal">Cerrar</button></div></div></div></div>'),$("#danger").modal("show")}function msjWarning(e,t){$("#mensajes").append('<div class="modal fade bd-example-modal-lg" id="warning" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header modal-header-warning"><h1>'+e+'</h1></div><div class="modal-body">'+t+'</div><div class="modal-footer"><button type="button" class="btn btn-default pull-rigth" data-dismiss="modal">Cerrar</button></div></div></div></div>'),$("#warning").modal("show")}function msjSucces(e,t){$("#mensajes").append('<div class="modal fade bd-example-modal-lg" id="success" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header modal-header-success"><h1>'+e+'</h1></div><div class="modal-body">'+t+'</div><div class="modal-footer"><button type="button" class="btn btn-default pull-rigth" data-dismiss="modal">Cerrar</button></div></div></div></div>'),$("#success").modal("show")}function msjInfo(e,t){$("#mensajes").append('<div class="modal fade bd-example-modal-lg" id="info" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header modal-header-info"><h1>'+e+'</h1></div><div class="modal-body">'+t+'</div><div class="modal-footer"><button type="button" class="btn btn-default pull-rigth" data-dismiss="modal">Cerrar</button></div></div></div></div>'),$("#info").modal("show")}function msjClean(){$("#mensajes").empty()}document.onload=addEventsPedidos();