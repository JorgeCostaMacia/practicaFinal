"use strict";class Ajax{callController(parameter,callBackFunction){$.ajax({url:"app/controller/ajax.php",type:"POST",data:parameter,dataType:"json",success:function(callBackData){eval(callBackFunction+"(callBackData)")},error:function(a,typeError,textError){let error0='{"errMessage": "Se ha producido un error en la conexion", "errCodeException": "", "errMessageException": "" }',error1='{"errMessage": "Se ha producido un error en la conexion", "errCodeException":"'+typeError+'", "errMessageException":"'+textError+'"}';eval(callBackFunction+'({"succes": false, "errores": ['+error0+","+error1+"]})")}})}}class Login{evalInputsLogin(){let e=[];return e.succes=!0,e.errores=[],e.errores.nick=!0,e.errores.pass=!0,validateNickLogin($("#nick").val())||(e.succes=!1,e.errores.nick=!1),validatePassLogin($("#pass").val())||(e.succes=!1,e.errores.pass=!1),e}getParameterLogin(){let e="action=login&";return e+=$("#formLogin").serialize()}getParameterAccesos(){let e="action=acceso&";return e+=$("#formLogin").serialize()}getTextErrorLogin(e){let r="";return e.nick||(r+="<strong>Formato de nick incorrecto</strong><br>",r+="Solo admite letras<br>",r+="Ha de contener al menos 5 caracteres<br>"),e.pass||(r+="<strong>Formato de password incorrecto</strong><br>",r+="Solo admite letras<br>",r+="Ha de contener al menos 5 caracteres<br>"),r}}class Registro{evalInputsRegistro(){let e=[];return e.succes=!0,e.errores=[],e.errores.nick=!0,e.errores.pass=!0,e.errores.nombre_completo=!0,e.errores.cif_dni=!0,e.errores.razon_social=!0,e.errores.domicilio_social=!0,e.errores.ciudad=!0,e.errores.email=!0,e.errores.telefono=!0,validateNickLogin($("#nickReg").val())||(e.succes=!1,e.errores.nick=!1),validatePassLogin($("#passReg").val())||(e.succes=!1,e.errores.pass=!1),validateNombreCompleto($("#nombre_completo").val())||(e.succes=!1,e.errores.nombre_completo=!1),validateCifDni($("#cif_dni").val())||(e.succes=!1,e.errores.cif_dni=!1),validateRazonSocial($("#razon_social").val())||(e.succes=!1,e.errores.razon_social=!1),validateDomicilioSocial($("#domicilio_social").val())||(e.succes=!1,e.errores.domicilio_social=!1),validateCiudad($("#ciudad").val())||(e.succes=!1,e.errores.ciudad=!1),validateEmail($("#email").val())||(e.succes=!1,e.errores.email=!1),validateTelefono($("#telefono").val())||(e.succes=!1,e.errores.telefono=!1),e}getParameterRegistro(){let e="action=registro&";return e+=$("#formGetAccount").serialize()}getTextErrorRegistro(e){let r="";return e.nick||(r+="<strong>Formato de nick incorrecto</strong><br>",r+="Solo admite letras<br>",r+="Ha de contener al menos 5 caracteres<br>"),e.pass||(r+="<strong>Formato de password incorrecto</strong><br>",r+="Solo admite letras<br>",r+="Ha de contener al menos 5 caracteres<br>"),e.nombre_completo||(r+="<strong>Formato de nombre completo incorrecto</strong><br>",r+="Solo admite letras y espacios<br>",r+="Ha de comenzar por una letra<br>",r+="Ha de contener un nombre y 2 apellidos separados por espacios<br>",r+="Ha de contener al menos 10 caracteres<br>"),e.cif_dni||(r+="<strong>Formato de CIF DNI incorrecto</strong><br>",r+="Ha de ser un CIF DNI correcto<br>"),e.razon_social||(r+="<strong>Formato de razon social incorrecto</strong><br>",r+="Solo admite letras y .<br>",r+="Ha de comenzar por una letra<br>",r+="Ha de contener nombre social . tipo empresa<br>",r+="Ha de contener al menos 5 caracteres<br>"),e.domicilio_social||(r+="<strong>Formato de domicilio social incorrecto</strong><br>",r+="Solo admite letras y  <br>",r+="Ha de comenzar por una letra<br>",r+="Puede contener tipo domicilio  nombre domicilio o nombre domicilio<br>",r+="Ha de contener al menos 5 caracteres<br>"),e.ciudad||(r+="<strong>Formato de ciudad incorrecto</strong><br>",r+="Solo admite letras y espacios<br>",r+="Ha de comenzar por una letra<br>",r+="Puede contener un unico espacio<br>",r+="Ha de contener al menos 5 caracteres<br>"),e.email||(r+="<strong>Formato de email incorrecto</strong><br>",r+="Ha de comenzar por una letra<br>",r+="Ha de contener nombre@email.dominio<br>"),e.telefono||(r+="<strong>Formato de telefono incorrecto</strong><br>",r+="Solo admite numeros y +<br>",r+="Ha de terminar en 9 numeros<br>",r+="Ha de contener al menos 9 caracteres<br>"),r}getTextExistRegistro(e){let r="";return 0===e.usuarios_cliente.length&&0===e.solicitudes.length||(r+="<strong>No se puede registrar</strong><br>"),0!==e.usuarios_cliente.length&&(r+="Existe un usuario registrado con los datos introducidos<br>"),0!==e.solicitudes.length&&(r+="Existe una solicitud pendiente con los datos introducidos<br>"),r}}function esTexto(e){let r=!0;if(""!==e&&null!==e)for(let o=0;o<e.length;o++)esLetra(e[o])||(r=!1,o=e.length);else r=!1;return r}function esTextoNumero(e){let r=!0;if(""!==e&&null!==e)for(let o=0;o<e.length;o++)esLetra(e[o])||esNumeros(e[o])||(r=!1,o=e.length);else r=!1;return r}function esTextoEspacio(e){let r=!0;if(""!==e&&null!==e)for(let o=0;o<e.length;o++)esLetra(e[o])||esEspacio(e[o])||(r=!1,o=e.length);else r=!1;return r}function esNumeroMas(e){let r=!0;if(""!==e&&null!==e)for(let o=0;o<e.length;o++)esNumero(e[o])||esMas(e[o])||(r=!1,o=e.length);else r=!1;return r}function esNumeroGuion(e){let r=!0;if(""!==e&&null!==e)for(let o=0;o<e.length;o++)esNumero(e[o])||esGuion(e[o])||(r=!1,o=e.length);else r=!1;return r}function esNumeros(e){let r=!0;if(""!==e&&null!==e)for(let o=0;o<e.length;o++)esNumero(e[o])||(r=!1,o=e.length);else r=!1;return r}function esTextoEspacioPuntoComaBarraNumero(e){let r=!0;if(""!==e&&null!==e)for(let o=0;o<e.length;o++)esTexto(e[o])||esEspacio(e[o])||esPunto(e[o])||esComa(e[o])||esNumero(e[o])||esBarra(e[o])||(r=!1,o=e.length);else r=!1;return r}function esTextoPunto(e){let r=!0;if(""!==e&&null!==e)for(let o=0;o<e.length;o++)esTexto(e[o])||esPunto(e[o])||(r=!1,o=e.length);else r=!1;return r}function esTextoBarra(e){let r=!0;if(""!==e&&null!==e)for(let o=0;o<e.length;o++)esTexto(e[o])||esPunto(e[o])||(r=!1,o=e.length);else r=!1;return r}function esNumeroPositivoEntero(e){return parseInt(e)&&esPositivo(e)&&esEntero(e)}function esLetra(e){return e.charCodeAt()>64&&e.charCodeAt()<91||165===e.charCodeAt()||164===e.charCodeAt()||e.charCodeAt()>96&&e.charCodeAt()<123}function esEspacio(e){return 32===e.charCodeAt()}function esNumero(e){return e.charCodeAt()>47&&e.charCodeAt()<58}function esPositivo(e){return parseInt(e)>0}function esEntero(e){return parseInt(e)%1==0}function esGuion(e){return 45===e.charCodeAt()}function esPunto(e){return 46===e.charCodeAt()}function esComa(e){return 44===e.charCodeAt()}function esContBarra(e){return 47===e.charCodeAt()}function esBarra(e){return 92===e.charCodeAt()}function esMas(e){return 43===e.charCodeAt()}function addformGetAccount(){msjClean(),$("#formLoginContainer").attr("class","container hidden"),$("#formAcountContainer").attr("class","container")}function addformLogin(){msjClean(),$("#formAcountContainer").attr("class","container hidden"),$("#formLoginContainer").attr("class","container")}function msjDanger(e,r){$("#mensajes").append('<div class="modal fade bd-example-modal-lg" id="danger" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header modal-header-danger"><h1>'+e+'</h1></div><div class="modal-body">'+r+'</div><div class="modal-footer"><button type="button" class="btn btn-default pull-rigth" data-dismiss="modal">Cerrar</button></div></div></div></div>'),$("#danger").modal("show")}function msjWarning(e,r){$("#mensajes").append('<div class="modal fade bd-example-modal-lg" id="warning" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header modal-header-warning"><h1>'+e+'</h1></div><div class="modal-body">'+r+'</div><div class="modal-footer"><button type="button" class="btn btn-default pull-rigth" data-dismiss="modal">Cerrar</button></div></div></div></div>'),$("#warning").modal("show")}function msjSucces(e,r){$("#mensajes").append('<div class="modal fade bd-example-modal-lg" id="success" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header modal-header-success"><h1>'+e+'</h1></div><div class="modal-body">'+r+'</div><div class="modal-footer"><button type="button" class="btn btn-default pull-rigth" data-dismiss="modal">Cerrar</button></div></div></div></div>'),$("#success").modal("show")}function msjInfo(e,r){$("#mensajes").append('<div class="modal fade bd-example-modal-lg" id="info" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header modal-header-info"><h1>'+e+'</h1></div><div class="modal-body">'+r+'</div><div class="modal-footer"><button type="button" class="btn btn-default pull-rigth" data-dismiss="modal">Cerrar</button></div></div></div></div>'),$("#info").modal("show")}function msjClean(){$("#mensajes").empty()}function evalRegistro(){msjClean();let e=registroApp.evalInputsRegistro();e.succes?ajaxApp.callController(registroApp.getParameterRegistro(),"callBackEvalRegistro"):msjDanger("REGISTRO",registroApp.getTextErrorRegistro(e.errores))}function callBackEvalRegistro(e){e.success?""===registroApp.getTextExistRegistro(e)?msjInfo("REGISTRO","Se ha registrado correctamente, en breve validaran su cuenta"):(msjWarning("REGISTRO",registroApp.getTextExistRegistro(e)),addformLogin()):msjDanger("LOGIN",e.errores[0].errMessage)}function evalLogin(){msjClean();let e=loginApp.evalInputsLogin();e.succes?ajaxApp.callController(loginApp.getParameterLogin(),"callBackEvalLogin"):msjDanger("LOGIN",loginApp.getTextErrorLogin(e.errores))}function callBackEvalLogin(e){e.success?0===e.usuarios_cliente.length&&0===e.usuarios_gestion.length?msjWarning("LOGIN","No existe el usuario"):"gestor"===$("#usuario").val()?ajaxApp.callController(loginApp.getParameterAccesos(),"callBackAcceso"):$("#formLogin").submit():msjDanger("LOGIN",e.errores[0].errMessage)}function callBackAcceso(e){e.success?$("#formLogin").submit():msjDanger("LOGIN",e.errores[0].errMessage)}function validateNickLogin(e){return esTexto(e)&&e.length>=5}function validatePassLogin(e){return esTexto(e)&&e.length>=5}function validateNombreCompleto(e){return esTextoEspacio(e)&&e.length>=10&&esFormatoNombre(e)}function validateCifDni(e){let r=e.substr(0,e.length-1),o=e.substr(e.length-1,1);return"TRWAGMYFPDXBNJZSQVHLCKET".substring(r%=23,r+1)===o.toUpperCase()}function esFormatoNombre(e){if(esLetra(e[0])){return 3===e.split(" ").length}return!1}function validateRazonSocial(e){return esTextoPunto(e)&&e.length>=5&&esFormatoRazonSocial(e)}function esFormatoRazonSocial(e){if(esLetra(e[0])){return 2===e.split(".").length}return!1}function validateDomicilioSocial(e){return esTextoBarra(e)&&e.length>=5&&esFormatoDomicilioSocial(e)}function esFormatoDomicilioSocial(e){if(esLetra(e[0])){let r=e.split("\\");return 2===r.length||1===r.length}return!1}function validateCiudad(e){return esTextoEspacio(e)&&e.length>=3&&esFormatoCiudad(e)}function esFormatoCiudad(e){if(esLetra(e[0])){let r=e.split(" ");return 2===r.length||1===r.length}return!1}function validateEmail(e){let r=!1,o=e.split("@");return 2===o.length&&esTexto(o[0])&&2===(o=o[1].split(".")).length&&esTexto(o[0])&&esTexto(o[1])&&(r=!0),r}function validateTelefono(e){return esNumeroMas(e)&&e.length>=9&&esFormatoTelefono(e)}function esFormatoTelefono(e){let r=!0;for(let o=e.length-1;o>e.length-10;o--)esNumero(e[o])||(r=!1);return r}var loginApp=new Login,ajaxApp=new Ajax,registroApp=new Registro;function addEventsLogin(){$("#entrar").click(evalLogin),$("#addFormRegistrar").click(addformGetAccount),$("#registrar").click(evalRegistro),$("#addFormLogin").click(addformLogin)}document.onload=addEventsLogin();