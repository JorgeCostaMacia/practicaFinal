class Ajax{callController(parameter,callBackFunction){$.ajax({url:"../app/controller/ajax.php",type:"POST",data:parameter,dataType:"json",success:function(callBackData){eval(callBackFunction+"(callBackData)")},error:function(a,typeError,textError){let error0='{"errMessage": "Se ha producido un error en la conexion", "errCodeException": "", "errMessageException": "" }',error1='{"errMessage": "Se ha producido un error en la conexion", "errCodeException":"'+typeError+'", "errMessageException":"'+textError+'"}';eval(callBackFunction+'({"succes": false, "errores": ['+error0+","+error1+"]})")}})}}class Articulos{getParameterSearchArticulos(){return"action=searchArticulos&"+$("#formSearch").serialize()}evalInputsUpdate(){let e=[];return e.succes=!0,e.errores=[],e.errores.nombre=!0,e.errores.descripcion=!0,e.errores.precio=!0,e.errores.descuento=!0,validateNombre($("#nombre").val())||(e.succes=!1,e.errores.nombre=!1),validateDescripcion($("#descripcion").val())||(e.succes=!1,e.errores.descripcion=!1),validatePrecio($("#precio").val())||(e.succes=!1,e.errores.precio=!1),validateDescuento($("#descuento").val())||(e.succes=!1,e.errores.descuento=!1),e}getParameterUpdate(){return"action=updateArticulo&"+$("#formModificar").serialize()}getTextErrorUpdate(e){let o="";return e.nombre||(o+="<strong>Formato de nombre incorrecto</strong><br>",o+="Solo admite letras<br>",o+="Ha de contener al menos 2 caracteres<br>"),e.descripcion||(o+="<strong>Formato de descripcion incorrecto</strong><br>",o+="Solo admite letras y espacios<br>",o+="Ha de comenzar por una letra<br>",o+="Ha de contener al menos 5 caracteres<br>"),e.precio||(o+="<strong>Formato de precio completo incorrecto</strong><br>",o+="Ha de contener numeros, admite decimales<br>",o+="Su valor minimo admisible es 0<br>"),e.descuento||(o+="<strong>Formato de descuento completo incorrecto</strong><br>",o+="Ha de contener numeros, admite decimales<br>",o+="Su valor minimo admisible es 0<br>",o+="Su valor maximo admisible es 1, equivale a 100%<br>"),o}}function search(){cleanTbody(),restoreArticulos(),delEventsSig(),delEventsAnt(),$("#numPage").val(1),injectPageNumber(),ajaxApp.callController(articulosApp.getParameterSearchArticulos(),"callBackSearchArticulos")}function callBackSearchArticulos(e){e.success?0!==e.articulos.length&&(articulos=e.articulos,injectArticulos(e.articulos),addEventsModificar(e.articulos),addEventsSiguiente()):msjDanger("ARTICULOS",e.errores[0].errMessage)}function searchSiguiente(){restoreArticulos(),delEventsSig(),delEventsAnt(),$("#numPage").val(1*$("#numPage").val()+1),ajaxApp.callController(articulosApp.getParameterSearchArticulos(),"callBackSearchSiguiente")}function callBackSearchSiguiente(e){e.success?(0!==e.articulos.length?(articulos=e.articulos,cleanTbody(),injectArticulos(e.articulos),addEventsModificar(e.articulos),addEventsSiguiente()):$("#numPage").val(1*$("#numPage").val()-1),"1"!==$("#numPage").val()&&addEventsAnterior(),injectPageNumber()):msjDanger("ARTICULOS",e.errores[0].errMessage)}function searchAnterior(){restoreArticulos(),delEventsSig(),delEventsAnt(),$("#numPage").val(1*$("#numPage").val()-1),ajaxApp.callController(articulosApp.getParameterSearchArticulos(),"callBackSearchAnterior")}function callBackSearchAnterior(e){e.success?(cleanTbody(),injectArticulos(e.articulos),addEventsModificar(e.articulos),addEventsSiguiente(),"1"!==$("#numPage").val()&&addEventsAnterior(),injectPageNumber()):msjDanger("ARTICULOS",e.errores[0].errMessage)}function showArticulo(e){cleanModificar();for(let e=0;e<articulos.length;e++)articulos[e].cod_articulo===this.id.split("-")[1]&&(injectModificar(articulos[e]),addEventsUpdate())}function evalModificar(){let e=articulosApp.evalInputsUpdate();e.succes?ajaxApp.callController(articulosApp.getParameterUpdate(),"callBackEvalUpdate"):msjDanger("ARTICULOS",articulosApp.getTextErrorUpdate(e.errores))}function callBackEvalUpdate(e){e.success?(msjSucces("ARTICULOS","<strong>Se ha modificado correctamente</strong>"),cleanTbody(),restoreArticulos()):msjDanger("ARTICULOS",e.errores[0].errMessage)}var articulosApp=new Articulos,ajaxApp=new Ajax,articulos="";function addEventsArticulos(){$("#search").click(search)}function addEventsSiguiente(){$("#siguiente").click(searchSiguiente)}function addEventsAnterior(){$("#anterior").click(searchAnterior)}function delEventsSig(){$("#siguiente").off()}function delEventsAnt(){$("#anterior").off()}function addEventsModificar(e){for(let o=0;o<e.length;o++)$("#modificar-"+e[o].cod_articulo).off(),$("#modificar-"+e[o].cod_articulo).click(showArticulo)}function addEventsUpdate(){$(document).off("click","#updateArticulo"),$(document).off("click","#buttonVolver"),$(document).on("click","#updateArticulo",evalModificar),$(document).on("click","#buttonVolver",restoreArticulos)}function validateNombre(e){return esTexto(e)&&e.length>=2}function validateDescripcion(e){return esTextoEspacio(e)&&e.length>=5&&esFormatoDescripcion(e)}function esFormatoDescripcion(e){return esLetra(e[0])}function validatePrecio(e){return esNumeroPositivoEntero(e)||"0"===e||esNumeroDecimal(e)&&e>0}function validateDescuento(e){return"0"===e||"1"===e||esNumeroDecimal(e)&&e>0&&e<=1}function esTexto(e){let o=!0;if(""!==e&&null!==e)for(let a=0;a<e.length;a++)esLetra(e[a])||(o=!1,a=e.length);else o=!1;return o}function esTextoNumero(e){let o=!0;if(""!==e&&null!==e)for(let a=0;a<e.length;a++)esLetra(e[a])||esNumeros(e[a])||(o=!1,a=e.length);else o=!1;return o}function esTextoEspacio(e){let o=!0;if(""!==e&&null!==e)for(let a=0;a<e.length;a++)esLetra(e[a])||esEspacio(e[a])||(o=!1,a=e.length);else o=!1;return o}function esNumeroMas(e){let o=!0;if(""!==e&&null!==e)for(let a=0;a<e.length;a++)esNumero(e[a])||esMas(e[a])||(o=!1,a=e.length);else o=!1;return o}function esNumeroGuion(e){let o=!0;if(""!==e&&null!==e)for(let a=0;a<e.length;a++)esNumero(e[a])||esGuion(e[a])||(o=!1,a=e.length);else o=!1;return o}function esNumeros(e){let o=!0;if(""!==e&&null!==e)for(let a=0;a<e.length;a++)esNumero(e[a])||(o=!1,a=e.length);else o=!1;return o}function esNumeroDecimal(e){let o=e.split(".");return 2===o.length&&("0"===o[0]||parseInt(o[0]))&&("0"===o[1]||parseInt(o[1]))}function esTextoEspacioPuntoComaBarraNumero(e){let o=!0;if(""!==e&&null!==e)for(let a=0;a<e.length;a++)esTexto(e[a])||esEspacio(e[a])||esPunto(e[a])||esComa(e[a])||esNumero(e[a])||esBarra(e[a])||(o=!1,a=e.length);else o=!1;return o}function esTextoPunto(e){let o=!0;if(""!==e&&null!==e)for(let a=0;a<e.length;a++)esTexto(e[a])||esPunto(e[a])||(o=!1,a=e.length);else o=!1;return o}function esTextoBarra(e){let o=!0;if(""!==e&&null!==e)for(let a=0;a<e.length;a++)esTexto(e[a])||esPunto(e[a])||(o=!1,a=e.length);else o=!1;return o}function esNumeroPositivoEntero(e){return parseInt(e)&&esPositivo(e)&&esEntero(e)}function esLetra(e){return e.charCodeAt()>64&&e.charCodeAt()<91||165===e.charCodeAt()||164===e.charCodeAt()||e.charCodeAt()>96&&e.charCodeAt()<123}function esEspacio(e){return 32===e.charCodeAt()}function esNumero(e){return e.charCodeAt()>47&&e.charCodeAt()<58}function esPositivo(e){return parseInt(e)>0}function esEntero(e){return parseInt(e)%1==0}function esGuion(e){return 45===e.charCodeAt()}function esPunto(e){return 46===e.charCodeAt()}function esComa(e){return 44===e.charCodeAt()}function esContBarra(e){return 47===e.charCodeAt()}function esBarra(e){return 92===e.charCodeAt()}function esMas(e){return 43===e.charCodeAt()}function cleanTbody(){$("#tbody").empty()}function restoreArticulos(){$("#tableModificar").empty(),$("#tableArticulos").attr("hidden",!1)}function cleanModificar(){$("#tableModificar").empty()}function injectArticulos(e){for(let o=0;o<e.length;o++)$("#tbody").append("<tr><td>"+e[o].cod_articulo+"</td><td>"+e[o].nombre+"</td><td>"+e[o].descripcion+'</td><td><button type="button" id="modificar-'+e[o].cod_articulo+'" value="'+e[o].cod_articulo+'" class="form-control btn-warning">Modificar</td></td></tr>')}function injectPageNumber(){$("#pageActual").empty(),$("#pageActual").append($("#numPage").val())}function injectModificar(e){let o='<form id="formModificar" method="POST"><input type="hidden" id="usuario" name="usuario" value="gestor"><input type="hidden" id="cod_articulo" name="cod_articulo" value="'+e.cod_articulo+'" value="gestor"><div class="col-lg-6 col-md-6 col-sm-12 col-xs-12"><div class="input-group input-group-lg"><span class="input-group-addon "><span class="glyphicon glyphicon-tag"></span></span><input type="text" class="form-control"  value="'+e.cod_articulo+'" aria-describedby="sizing-addon1" disabled></div><br></div><div class="col-lg-6 col-md-6 col-sm-12 col-xs-12"><div class="input-group input-group-lg"><span class="input-group-addon "><span class="glyphicon glyphicon-tag"></span></span><input type="text" name="nombre" id="nombre" maxlength="30" class="form-control" value="'+e.nombre+'" placeholder="Nombre" aria-describedby="sizing-addon1" required></div><br></div><div class="col-lg-6 col-md-6 col-sm-12 col-xs-12"><div class="input-group input-group-lg"><span class="input-group-addon"><span class="glyphicon glyphicon-pencil"></span></span><input type="text" name="descripcion" id="descripcion" maxlength="30" class="form-control" value="'+e.descripcion+'" placeholder="Descripcion" required></div><br/></div><div class="col-lg-6 col-md-6 col-sm-12 col-xs-12"><div class="input-group input-group-lg"><span class="input-group-addon"><span class="glyphicon glyphicon-euro"></span></span><input type="number" name="precio" id="precio" maxlength="10" step="1" min="0" class="form-control" value="'+e.precio+'" placeholder="Precio" required></div><br></div><div class="col-lg-6 col-md-6 col-sm-12 col-xs-12"><div class="input-group input-group-lg"><span class="input-group-addon"><span class="glyphicon glyphicon-euro"></span></span><input type="number" name="descuento" id="descuento" maxlength="10" step="0.01" min="0" max="1" class="form-control" value="'+e.descuento+'" placeholder="Descuento" required></div><br></div><div class="col-lg-6 col-md-6 col-sm-12 col-xs-12"><div class="input-group input-group-lg"><span class="input-group-addon"><span class="glyphicon glyphicon-euro"></span></span><select name="iva" id="iva" class="form-control">';"0"===e.iva?(o+='<option value="0" selected>Iva 0</option>',o+='<option value="0.04">Iva 0.04</option>',o+='<option value="0.10">Iva 0.10</option>',o+='<option value="0.21">Iva 0.21</option>'):"0.04"===e.iva?(o+='<option value="0">Iva 0</option>',o+='<option value="0.04" selected>Iva 0.04</option>',o+='<option value="0.10">Iva 0.10</option>',o+='<option value="0.21">Iva 0.21</option>'):"0.1"===e.iva||"0.10"===e.iva?(o+='<option value="0">Iva 0</option>',o+='<option value="0.04">Iva 0.04</option>',o+='<option value="0.10" selected>Iva 0.10</option>',o+='<option value="0.21">Iva 0.21</option>'):"0.21"===e.iva&&(o+='<option value="0">Iva 0</option>',o+='<option value="0.04">Iva 0.04</option>',o+='<option value="0.10">Iva 0.10</option>',o+='<option value="0.21" selected>Iva 0.21</option>'),o+='</select></div><br></div><div class="col-lg-6 col-md-6 col-sm-12 col-xs-12"><div class="input-group input-group-lg"><span class="input-group-addon"><span class="glyphicon glyphicon-cog"></span></span><select name="estado" id="estado" class="form-control">',"activo"===e.estado?(o+='<option value="activo" selected>Activo</option>',o+='<option value="inactivo">Inactivo</option>'):(o+='<option value="activo">Activo</option>',o+='<option value="inactivo" selected>Inactivo</option>'),o+='</select></div><br></div><div class="col-lg-12"><button type="button" name="updateArticulo" id="updateArticulo" class="btn btn-warning btn-block">Modificar</button><button type="button" id="buttonVolver" name="buttonVolver" class="btn btn-primary btn-block">Volver articulos</button></div></form>',$("#tableArticulos").attr("hidden",!0),$("#tableModificar").append(o)}function msjDanger(e,o){let a=Math.floor(1e16*Math.random()+1);$("#mensajes").append('<div class="modal fade bd-example-modal-lg" id="danger'+a+'" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header modal-header-danger"><h1>'+e+'</h1></div><div class="modal-body">'+o+'</div><div class="modal-footer"><button type="button" class="btn btn-default pull-rigth" data-dismiss="modal">Cerrar</button></div></div></div></div>'),$("#danger"+a).modal("show")}function msjWarning(e,o){let a=Math.floor(1e16*Math.random()+1);$("#mensajes").append('<div class="modal fade bd-example-modal-lg" id="warning'+a+'" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header modal-header-warning"><h1>'+e+'</h1></div><div class="modal-body">'+o+'</div><div class="modal-footer"><button type="button" class="btn btn-default pull-rigth" data-dismiss="modal">Cerrar</button></div></div></div></div>'),$("#warning"+a).modal("show")}function msjSucces(e,o){let a=Math.floor(1e16*Math.random()+1);$("#mensajes").append('<div class="modal fade bd-example-modal-lg" id="success'+a+'" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header modal-header-success"><h1>'+e+'</h1></div><div class="modal-body">'+o+'</div><div class="modal-footer"><button type="button" class="btn btn-default pull-rigth" data-dismiss="modal">Cerrar</button></div></div></div></div>'),$("#success"+a).modal("show")}function msjInfo(e,o){let a=Math.floor(1e16*Math.random()+1);$("#mensajes").append('<div class="modal fade bd-example-modal-lg" id="info'+a+'" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header modal-header-info"><h1>'+e+'</h1></div><div class="modal-body">'+o+'</div><div class="modal-footer"><button type="button" class="btn btn-default pull-rigth" data-dismiss="modal">Cerrar</button></div></div></div></div>'),$("#info"+a).modal("show")}document.onload=addEventsArticulos();