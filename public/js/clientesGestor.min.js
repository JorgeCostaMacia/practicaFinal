"use strict";class Ajax{callController(parameter,callBackFunction){$.ajax({url:"../app/controller/ajax.php",type:"POST",data:parameter,dataType:"json",success:function(callBackData){eval(callBackFunction+"(callBackData)")},error:function(a,typeError,textError){let error0='{"errMessage": "Se ha producido un error en la conexion", "errCodeException": "", "errMessageException": "" }',error1='{"errMessage": "Se ha producido un error en la conexion", "errCodeException":"'+typeError+'", "errMessageException":"'+textError+'"}';eval(callBackFunction+'({"succes": false, "errores": ['+error0+","+error1+"]})")}})}}class Clientes{getParameterSearchClientes(){return"action=searchClientes&"+$("#formSearch").serialize()}evalInputsUpdate(){let e=[];return e.succes=!0,e.errores=[],e.errores.pass=!0,e.errores.razon_social=!0,e.errores.domicilio_social=!0,e.errores.ciudad=!0,e.errores.email=!0,e.errores.telefono=!0,validatePassLogin($("#passReg").val())||(e.succes=!1,e.errores.pass=!1),validateRazonSocial($("#razon_social").val())||(e.succes=!1,e.errores.razon_social=!1),validateDomicilioSocial($("#domicilio_social").val())||(e.succes=!1,e.errores.domicilio_social=!1),validateCiudad($("#ciudad").val())||(e.succes=!1,e.errores.ciudad=!1),validateEmail($("#email").val())||(e.succes=!1,e.errores.email=!1),validateTelefono($("#telefono").val())||(e.succes=!1,e.errores.telefono=!1),e}getParameterUpdate(){return"action=updateCliente&"+$("#formGetAccount").serialize()}getTextErrorUpdate(e){let a="";return e.pass||(a+="<strong>Formato de password incorrecto</strong><br>",a+="Solo admite letras<br>",a+="Ha de contener al menos 5 caracteres<br>"),e.razon_social||(a+="<strong>Formato de razon social incorrecto</strong><br>",a+="Solo admite letras y .<br>",a+="Ha de comenzar por una letra<br>",a+="Ha de contener nombre social . tipo empresa<br>",a+="Ha de contener al menos 5 caracteres<br>"),e.domicilio_social||(a+="<strong>Formato de domicilio social incorrecto</strong><br>",a+="Solo admite letras y  <br>",a+="Ha de comenzar por una letra<br>",a+="Puede contener tipo domicilio  nombre domicilio o nombre domicilio<br>",a+="Ha de contener al menos 5 caracteres<br>"),e.ciudad||(a+="<strong>Formato de ciudad incorrecto</strong><br>",a+="Solo admite letras y espacios<br>",a+="Ha de comenzar por una letra<br>",a+="Puede contener un unico espacio<br>",a+="Ha de contener al menos 5 caracteres<br>"),e.email||(a+="<strong>Formato de email incorrecto</strong><br>",a+="Ha de comenzar por una letra<br>",a+="Ha de contener nombre@email.dominio<br>"),e.telefono||(a+="<strong>Formato de telefono incorrecto</strong><br>",a+="Solo admite numeros y +<br>",a+="Ha de terminar en 9 numeros<br>",a+="Ha de contener al menos 9 caracteres<br>"),a}}function search(){cleanTbody(),restoreClientes(),delEventsSig(),delEventsAnt(),$("#numPage").val(1),injectPageNumber(),msjClean(),ajaxApp.callController(clientesApp.getParameterSearchClientes(),"callBackSearchClientes")}function callBackSearchClientes(e){e.success?0!==e.usuarios_cliente.length&&(clientes=e.usuarios_cliente,injectClientes(e.usuarios_cliente),addEventsModificar(e.usuarios_cliente),addEventsSiguiente()):msjDanger("SEARCH CLIENTES",e.errores[0].errMessage)}function searchSiguiente(){restoreClientes(),delEventsSig(),delEventsAnt(),msjClean(),$("#numPage").val(1*$("#numPage").val()+1),ajaxApp.callController(clientesApp.getParameterSearchClientes(),"callBackSearchSiguiente")}function callBackSearchSiguiente(e){e.success?(0!==e.usuarios_cliente.length?(clientes=e.usuarios_cliente,cleanTbody(),injectClientes(e.usuarios_cliente),addEventsModificar(e.usuarios_cliente),addEventsSiguiente()):$("#numPage").val(1*$("#numPage").val()-1),"1"!==$("#numPage").val()&&addEventsAnterior(),injectPageNumber()):msjDanger("SEARCH PEDIDOS",e.errores[0].errMessage)}function searchAnterior(){restoreClientes(),delEventsSig(),delEventsAnt(),msjClean(),$("#numPage").val(1*$("#numPage").val()-1),ajaxApp.callController(clientesApp.getParameterSearchClientes(),"callBackSearchAnterior")}function callBackSearchAnterior(e){e.success?(cleanTbody(),injectClientes(e.usuarios_cliente),addEventsModificar(e.usuarios_cliente),addEventsSiguiente(),"1"!==$("#numPage").val()&&addEventsAnterior(),injectPageNumber()):msjDanger("SEARCH PEDIDOS",e.errores[0].errMessage)}function showCliente(e){$("#tableModificar").empty();for(let e=0;e<clientes.length;e++)clientes[e].cod_cliente===this.id.split("-")[1]&&(injectModificar(clientes[e]),addEventsUpdate())}function evalModificar(){msjClean();let e=clientesApp.evalInputsUpdate();e.succes?ajaxApp.callController(clientesApp.getParameterUpdate(),"callBackEvalUpdate"):msjDanger("UPDATE",clientesApp.getTextErrorUpdate(e.errores))}function callBackEvalUpdate(e){e.success?msjInfo("UPDATE","Se ha modificado correctamente"):msjDanger("UPDATE",e.errores[0].errMessage)}function validatePassLogin(e){return esTexto(e)&&e.length>=5}function validateRazonSocial(e){return esTextoPunto(e)&&e.length>=5&&esFormatoRazonSocial(e)}function esFormatoRazonSocial(e){if(esLetra(e[0])){return 2===e.split(".").length}return!1}function validateDomicilioSocial(e){return esTextoBarra(e)&&e.length>=5&&esFormatoDomicilioSocial(e)}function esFormatoDomicilioSocial(e){if(esLetra(e[0])){let a=e.split("\\");return 2===a.length||1===a.length}return!1}function validateCiudad(e){return esTextoEspacio(e)&&e.length>=3&&esFormatoCiudad(e)}function esFormatoCiudad(e){if(esLetra(e[0])){let a=e.split(" ");return 2===a.length||1===a.length}return!1}function validateEmail(e){let a=!1,n=e.split("@");return 2===n.length&&esTexto(n[0])&&2===(n=n[1].split(".")).length&&esTexto(n[0])&&esTexto(n[1])&&(a=!0),a}function validateTelefono(e){return esNumeroMas(e)&&e.length>=9&&esFormatoTelefono(e)}function esFormatoTelefono(e){let a=!0;for(let n=e.length-1;n>e.length-10;n--)esNumero(e[n])||(a=!1);return a}var clientesApp=new Clientes,ajaxApp=new Ajax,clientes="";function addEventsClientes(){$("#search").click(search)}function addEventsSiguiente(){$("#siguiente").click(searchSiguiente)}function addEventsAnterior(){$("#anterior").click(searchAnterior)}function delEventsSig(){$("#siguiente").off()}function delEventsAnt(){$("#anterior").off()}function addEventsModificar(e){for(let a=0;a<e.length;a++)$("#modificar-"+e[a].cod_cliente).off(),$("#modificar-"+e[a].cod_cliente).click(showCliente)}function addEventsUpdate(){$(document).on("#updateCliente").off(),$(document).on("#buttonVolver").off(),$(document).on("click","#updateCliente",evalModificar),$(document).on("click","#buttonVolver",restoreClientes)}function esTexto(e){let a=!0;if(""!==e&&null!==e)for(let n=0;n<e.length;n++)esLetra(e[n])||(a=!1,n=e.length);else a=!1;return a}function esTextoNumero(e){let a=!0;if(""!==e&&null!==e)for(let n=0;n<e.length;n++)esLetra(e[n])||esNumeros(e[n])||(a=!1,n=e.length);else a=!1;return a}function esTextoEspacio(e){let a=!0;if(""!==e&&null!==e)for(let n=0;n<e.length;n++)esLetra(e[n])||esEspacio(e[n])||(a=!1,n=e.length);else a=!1;return a}function esNumeroMas(e){let a=!0;if(""!==e&&null!==e)for(let n=0;n<e.length;n++)esNumero(e[n])||esMas(e[n])||(a=!1,n=e.length);else a=!1;return a}function esNumeroGuion(e){let a=!0;if(""!==e&&null!==e)for(let n=0;n<e.length;n++)esNumero(e[n])||esGuion(e[n])||(a=!1,n=e.length);else a=!1;return a}function esNumeros(e){let a=!0;if(""!==e&&null!==e)for(let n=0;n<e.length;n++)esNumero(e[n])||(a=!1,n=e.length);else a=!1;return a}function esTextoEspacioPuntoComaBarraNumero(e){let a=!0;if(""!==e&&null!==e)for(let n=0;n<e.length;n++)esTexto(e[n])||esEspacio(e[n])||esPunto(e[n])||esComa(e[n])||esNumero(e[n])||esBarra(e[n])||(a=!1,n=e.length);else a=!1;return a}function esTextoPunto(e){let a=!0;if(""!==e&&null!==e)for(let n=0;n<e.length;n++)esTexto(e[n])||esPunto(e[n])||(a=!1,n=e.length);else a=!1;return a}function esTextoBarra(e){let a=!0;if(""!==e&&null!==e)for(let n=0;n<e.length;n++)esTexto(e[n])||esPunto(e[n])||(a=!1,n=e.length);else a=!1;return a}function esNumeroPositivoEntero(e){return parseInt(e)&&esPositivo(e)&&esEntero(e)}function esLetra(e){return e.charCodeAt()>64&&e.charCodeAt()<91||165===e.charCodeAt()||164===e.charCodeAt()||e.charCodeAt()>96&&e.charCodeAt()<123}function esEspacio(e){return 32===e.charCodeAt()}function esNumero(e){return e.charCodeAt()>47&&e.charCodeAt()<58}function esPositivo(e){return parseInt(e)>0}function esEntero(e){return parseInt(e)%1==0}function esGuion(e){return 45===e.charCodeAt()}function esPunto(e){return 46===e.charCodeAt()}function esComa(e){return 44===e.charCodeAt()}function esContBarra(e){return 47===e.charCodeAt()}function esBarra(e){return 92===e.charCodeAt()}function esMas(e){return 43===e.charCodeAt()}function cleanTbody(){$("#tbody").empty()}function restoreClientes(){$("#tableModificar").empty(),$("#tableClientes").attr("hidden",!1)}function cleanModificar(){$("#tableModificar").empty()}function injectClientes(e){for(let a=0;a<e.length;a++)$("#tbody").append('<tr><td><input type="button" value="'+e[a].cod_cliente+'" class="form-control btn-default"></td><td><input type="button" value="'+e[a].cif_dni+'" class="form-control btn-default"></td><td><input type="button" value="'+e[a].nombre_completo+'" class="form-control btn-default"></td><td><input type="button" value="'+e[a].razon_social+'" class="form-control btn-default"></td><td><button type="button" id="modificar-'+e[a].cod_cliente+'" value="'+e[a].cod_cliente+'" class="form-control btn-warning">Modificar</td></td></tr>')}function injectPageNumber(){$("#pageActual").empty(),$("#pageActual").append($("#numPage").val())}function injectModificar(e){let a='<div class="container" id="formAcountContainer"><form id="formGetAccount" method="POST" class="col-md-6 col-md-offset-3 panel panel-default"><input type="hidden" id="usuario" name="usuario" value="gestor"><input type="hidden" name="cod_cliente" value="'+e.cod_cliente+'"><div class="panel-body"><h3 class="text-center">Modificar cliente</h3><div class="input-group input-group-lg"><span class="input-group-addon "><i class="fa fa-user" aria-hidden="true"><span class="glyphicon glyphicon-user"></span></i></span><input type="text" name="cod_cliente" id="cod_cliente" maxlength="30" class="form-control" placeholder="Nick" aria-describedby="sizing-addon1" value="'+e.cod_cliente+'" disabled></div><br><div class="input-group input-group-lg"><span class="input-group-addon "><i class="fa fa-user" aria-hidden="true"><span class="glyphicon glyphicon-user"></span></i></span><input type="text" name="nick" id="nickReg" maxlength="30" class="form-control" placeholder="Nick" aria-describedby="sizing-addon1" value="'+e.nick+'" disabled></div><br><div class="input-group input-group-lg"><span class="input-group-addon"><i class="fa fa-key" aria-hidden="true"><span class="glyphicon glyphicon-lock"></span></i></span><input type="password" name="password" id="passReg" maxlength="30" class="form-control" placeholder="Password" value="'+e.password+'" required></div><br/><div class="input-group input-group-lg"><span class="input-group-addon"><i class="fa fa-key" aria-hidden="true"><span class="glyphicon glyphicon-user"></span></i></span><input type="text" name="nombre_completo" id="nombre_completo" maxlength="30" class="form-control" placeholder="Nombre completo" value="'+e.nombre_completo+'" disabled></div><br><div class="input-group input-group-lg"><span class="input-group-addon"><i class="fa fa-key" aria-hidden="true"><span class="glyphicon glyphicon-user"></span></i></span><input type="text" name="cif_dni" id="cif_dni" maxlength="30" class="form-control" placeholder="CIF / DNI" value="'+e.cif_dni+'" disabled></div><br><div class="input-group input-group-lg"><span class="input-group-addon"><i class="fa fa-key" aria-hidden="true"><span class="glyphicon glyphicon-briefcase"></span></i></span><input type="text" name="razon_social" id="razon_social" maxlength="30" class="form-control" placeholder="Razon social" value="'+e.razon_social+'" required></div><br><div class="input-group input-group-lg"><span class="input-group-addon"><i class="fa fa-key" aria-hidden="true"><span class="glyphicon glyphicon-briefcase"></span></i></span><input type="text" name="domicilio_social" id="domicilio_social" maxlength="30" class="form-control" placeholder="Domicilio social" value="'+e.domicilio_social+'" required></div><br><div class="input-group input-group-lg"><span class="input-group-addon"><i class="fa fa-key" aria-hidden="true"><span class="glyphicon glyphicon-map-marker"></span></i></span><input type="text" name="ciudad" id="ciudad" maxlength="30" class="form-control" placeholder="Ciudad" value="'+e.ciudad+'" required></div><br><div class="input-group input-group-lg"><span class="input-group-addon"><i class="fa fa-key" aria-hidden="true"><span class="glyphicon glyphicon-envelope"></span></i></span><input type="email" name="email" id="email" maxlength="30" class="form-control" placeholder="Email" value="'+e.email+'" required></div><br><div class="input-group input-group-lg"><span class="input-group-addon"><i class="fa fa-key" aria-hidden="true"><span class="glyphicon glyphicon-earphone"></span></i></span><input type="text" name="telefono" id="telefono" maxlength="30" class="form-control" placeholder="Telefono" value="'+e.telefono+'" required></div><br><div class="input-group input-group-lg"><span class="input-group-addon"><i class="fa fa-key" aria-hidden="true"><span class="glyphicon glyphicon-cog"></span></i></span><select name="estado" id="estado" class="form-control">';"activo"===e.estado?(a+='<option value="activo" checked>Activo</option>',a+='<option value="inactivo">Inactivo</option>'):(a+='<option value="activo">Activo</option>',a+='<option value="inactivo" checked>Inactivo</option>'),a+='</select></div><br><button type="button" name="updateCliente" id="updateCliente" class="btn btn-warning btn-block">Modificar</button><button type="button" id="buttonVolver" name="buttonVolver" class="btn btn-primary btn-block">Volver clientes</button></div></form></div>',$("#tableClientes").attr("hidden",!0),$("#tableModificar").append(a)}function msjDanger(e,a){$("#mensajes").append('<div class="modal fade bd-example-modal-lg" id="danger" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header modal-header-danger"><h1>'+e+'</h1></div><div class="modal-body">'+a+'</div><div class="modal-footer"><button type="button" class="btn btn-default pull-rigth" data-dismiss="modal">Cerrar</button></div></div></div></div>'),$("#danger").modal("show")}function msjWarning(e,a){$("#mensajes").append('<div class="modal fade bd-example-modal-lg" id="warning" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header modal-header-warning"><h1>'+e+'</h1></div><div class="modal-body">'+a+'</div><div class="modal-footer"><button type="button" class="btn btn-default pull-rigth" data-dismiss="modal">Cerrar</button></div></div></div></div>'),$("#warning").modal("show")}function msjSucces(e,a){$("#mensajes").append('<div class="modal fade bd-example-modal-lg" id="success" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header modal-header-success"><h1>'+e+'</h1></div><div class="modal-body">'+a+'</div><div class="modal-footer"><button type="button" class="btn btn-default pull-rigth" data-dismiss="modal">Cerrar</button></div></div></div></div>'),$("#success").modal("show")}function msjInfo(e,a){$("#mensajes").append('<div class="modal fade bd-example-modal-lg" id="info" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header modal-header-info"><h1>'+e+'</h1></div><div class="modal-body">'+a+'</div><div class="modal-footer"><button type="button" class="btn btn-default pull-rigth" data-dismiss="modal">Cerrar</button></div></div></div></div>'),$("#info").modal("show")}function msjClean(){$("#mensajes").empty()}document.onload=addEventsClientes();